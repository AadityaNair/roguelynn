<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">

        <title>Explain like I'm 5: Kerberos — Lynn Root</title>
        <meta name="description" content="Homepage and blog of Lynn Root. Python Engineer, PyLadiesSF Founder, Socializer in San Francisco." />
        <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/ico" />
        <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="http://www.roguelynn.com/feed.xml" />

        <!--Stylesheets-->
        <link rel="stylesheet" href="/assets/css/lightbox.css" media="screen" title="screen">
        <link rel="stylesheet" href="/assets/css/pygments.css" media="screen" title="screen">
        <link rel="stylesheet" href="/assets/css/screen.css" media="screen" title="screen">


        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class="nav-wrapper">
            <nav>
                <ul class="title">
                    <li class="name"><a class="current" href="/">Lynn Root</a></li>
                    <li class="desc">Coder • Writer • Speaker • PyLady</li>
                </ul>
                <ul class="contents"> 
                    <li class="page_item"><a href="/">Home</a></li>
                    <li class="page_item"><a href="/about/">About</a></li>
                    <li class="page_item"><a href="/words/">Words</a></li>
                    <li class="page_item"><a href="/talks/">Talks</a></li>
                    <li class="page_item"><a href="/pyladies/">PyLadies</a></li>

                </ul>
            </nav>
        </div>
        <div class="page">
            
    <section id="post">
        <h2>Explain like I'm 5: Kerberos</h2>
        <aside>
            <time pubdate datetime="2013-03-26">March 26, 2013</time>
        </aside>
        <article>
            <p>Explain like I’m 5 years old: Kerberos – what is Kerberos, and why should I care?</p>
<h3>In a nutshell</h3>
<p>Basically, Kerberos comes down to just this:</p>

<ul>
<li>a protocol for authentication</li>
<li>uses tickets to authenticate</li>
<li>involves a trusted 3rd-party</li>
<li>built on symetric-key crypto</li>
</ul>

<p>You have a <strong>ticket</strong> – your username encrypted with the requested service’s key – and so long as it’s valid, you can access the requested service that is within a Kerberos realm.</p>

<p>Typically, this is used within corporate/internal environments. Perhaps you want to access the internal benefits site. Rather than re-entering your user/password credentials, your ticket (cached on your system) is used to authenticate allowing for single sign-on.</p>

<p>Your ticket is refreshed when you sign on to your computer, or when you <code>kinit USER</code> within your terminal.</p>

<p>For the trivia-loving folks, Kerberos’ name comes from <a href="%22http://en.wikipedia.org/wiki/Kerberos_(protocol)#History_and_development%22">Greek mythology</a>, the three-headed guard dog of <a href="http://en.wikipedia.org/wiki/Hades">Hades</a>. It’s pretty fitting since it takes a third-party (a Key Distribution Center) to authenticate between a client and a service or host machine.</p>

<p><img class="displayed" src="http://upload.wikimedia.org/wikipedia/commons/7/71/Hades-et-Cerberus-III.jpg" width="300" height="450"/></p>

<p>Now, the gritty details on how it works: </p>
<h3>Kerberos Realm</h3>
<p>An admin (or two, or many) creates a realm (or multiple) – the Kerberos realm – that will encompass all that is available to access.  Granted, <strong>you</strong> may not have access to certain services or host machines that is defined within the policy management – developers should not access anything finance related, stuff like that. But the realm(s) define what Kerberos manages in terms of who can access what. </p>

<p>Your machine, the Client, lives within this realm, as well as the service you want to request and the Key Distribution Center (KDC).  In the example below, I separate out the Authoritative Server and the Ticket Granting Server, but both are within the KDC.</p>

<p>The example below describes what happens when you request something from an internal HTTP Service – like information on your benefits within your corporate intranet.</p>

<p><img class="displayed" src="/assets/images/Kerb.001.jpg" width="500" height="400" alt="Kerberos Realm"/></p>
<h3>You and the Authentication Server</h3>
<p>You log into your machine with your username and password. Behind the scenes, your machine has created a secret key, a hash of your username and password.</p>

<p>You want to access an HTTP Service, so a plaintext request is sent to an Authentication Server, a part of the KDC.</p>

<p><img class="displayed" src="/assets/images/Kerb.002.jpg" width="500" height="400" alt="Request"/></p>

<p>The Authentication Server will check if you are in its database (e.g. LDAP) as well as the requested service (the HTTP service).</p>

<p><img class="displayed" src="/assets/images/Kerb.003.jpg" width="500" height="400" alt="DB check"/></p>

<p>If all is good, it will generate your Client Secret Key, based on your username and password, that you can decrypt. This is a shared secret between you and the Authentication Server.</p>

<p>The Authentiation Server will then send two messages back to you. One message is a Client Session Key for the Ticket Granting Server (also a part of the KDC) that is encrypted with your Client Secret Key.  Because your machine has the Client Secret Key, it can decrypt the Client/Ticket Granting Service Session Key.</p>

<p><img class="displayed" src="/assets/images/Kerb.004.jpg" width="500" height="400" alt="Auth2Client"/></p>

<p>The second message is the Ticket Granting Ticket that includes your client ID, network address, validity period of the ticket and the Client/Ticket Granting Server Session Key. This second message is encrypted with the Ticket Granting Server Secret Key.</p>

<p><img class="displayed" src="/assets/images/Kerb.005.jpg" width="500" height="400" alt="ClientDecryptAuth"/></p>
<h3>You and the Ticket Granting Server</h3>
<p>Your machine can’t decode the second message (the Ticket Granting Ticket), so it sends two messages to the Ticket Granting Server.  One message is Ticket Granting Ticket that is encrypted with the Ticket Granting Server Secret Key, plus the identifier of the service that you want (access to the HTTP Service).</p>

<p><img class="displayed" src="/assets/images/Kerb.006.jpg" width="500" height="400" alt="Client2TGS"/></p>

<p>The other message that is sent to the Ticket Granting Service is an Authenticator that contains your client ID as well as a timestamp that is encrypted with the Client/Ticket Granting Server Session Key from the very first message received from the Authentication Server.</p>

<p>The Ticket Granting Server decrypts the first message and receives the Ticket Granting Ticket.</p>

<p><img class="displayed" src="/assets/images/Kerb.007.jpg" width="500" height="400" alt="TGSDecrypt"/></p>

<p>In order for the Ticket Granting Server to confirm your Client ID, timestamps and validity period of the Ticket, it decrypts the second message you sent, the Authenticator, with your Client/Ticket Granting Server Session Key it got from decrypting the Ticket Granting Ticket. </p>

<p>The Ticket Granting Server then sends you two messages: the first is a ticket for you to talk to the HTTP service that contains information about your ID, the validity period of this ticket, network address, and a Client/HTTP Service Session Key, and is encrypted with the HTTP Service Secret Key. Only the HTTP Service can decrypt this new ticket.</p>

<p><img class="displayed" src="/assets/images/Kerb.008.jpg" width="500" height="400" alt="TGS2Client"/></p>

<p>The second message is the Client/HTTP Service Session Key that’s encrypted with the Client/Ticket Granting Server Session Key.</p>
<h3>You and the HTTP Service</h3>
<p>Your machine then decrypts the last message with the Client/Ticket Granting Server Session key to obtain the Client/HTTP Service Session key. Your machine can’t, however, decrypt the ticket for the HTTP Service since it’s encrypted with the HTTP Service Secret Key.</p>

<p><img class="displayed" src="/assets/images/Kerb.009.jpg" width="500" height="400" alt="ClientDecryptTGS"/></p>

<p>Your machine then sends the first message that the Ticket Granting Server sent you, the ticket for the HTTP Service that is encrypted with the HTTP Service Secret Key. Your machine also then sends an Authenticator that contains your client ID plus a timestamp that is encrypted with the Client/Ticket Granting Server Session Key.</p>

<p><img class="displayed" src="/assets/images/Kerb.010.jpg" width="500" height="400" alt="Client2HTTP"/></p>

<p>The HTTP Service then decrypts your first message with its secret key to get your client ID, network address, validity period, and the Client/HTTP Service Session Key.</p>

<p><img class="displayed" src="/assets/images/Kerb.011.jpg" width="500" height="400" alt="HTTPDecrypt"/></p>

<p>It then decrypts your second message using the Client/HTTP Service Session Key. It can then compare the second message’s client ID and timestamp to the information decrypted from your first message.</p>

<p>The HTTP Service then sends an Authenticator message to you confirming its identity to you, with a message containing timestamp + 1 and is encrypted with the Client/HTTP Service Session key.</p>

<p><img class="displayed" src="/assets/images/Kerb.012.jpg" width="500" height="400" alt="HTTPAuth"/></p>

<p>Your machine receives the Authenticator message, and knows that it has to receive a message with timestamp + 1. It decrypts the message with the Client/HTTP Service Session Key.</p>

<p><img class="displayed" src="/assets/images/Kerb.013.jpg" width="500" height="400" alt="ClientDecryptHTTP"/></p>

<p>And now both you and the HTTP Service have been authenticated!</p>

<p><img class="displayed" src="/assets/images/Kerb.014.jpg" width="500" height="400" alt="Authed"/></p>

<p>In a future post, I’ll write up how to actually setup a server for Kerberos authentication.</p>

<hr>

<p>Some current implementations of Kerberos:</p>

<ul>
<li><a href="http://technet.microsoft.com/en-us/library/bb742516.aspx">Windows Active Directory</a></li>
<li><a href="http://freeipa.org">freeIPA</a></li>
<li><a href="http://www.h5l.org/">Heimdal</a> </li>
<li><a href="http://www.gnu.org/software/shishi/">GNU Shishi</a></li>
</ul>

<p>Other resources for Kerberos:</p>

<ul>
<li><a href="http://content.hccfl.edu/pollock/AUnixSec/MoronsGuideToKerberos.htm">Moron&#39;s Guide to Kerberos</a></li>
<li>Video: <a href="http://www.youtube.com/watch?v=7-LjpO2nTJo">Kerberos Authentication Guide</a></li>
<li><a href="http://www.ietf.org/rfc/rfc4120.txt">RFC 4120: The Kerberos Network Authentication Service v5</a></li>
</ul>

            <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'roguelynn'; // required: replace example with your forum shortname

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>
    </section>
    <p><a href="/words/">&larr; See all posts</a></p>
    <p><iframe style="border: 0; margin: 0; padding: 0;"
        src="https://www.gittip.com/roguelynn/widget.html"
        width="48pt" height="22pt"></iframe></p>

        </div>
        <div class="footer-wrapper">
            <footer id="bottom">
                <ul class="social">
                    <li><a class="icon twitter" data-icon="&#62217;" href="http://twitter.com/roguelynn" title="Twitter"></a></li>
                    <li><a class="icon github" data-icon="&#62208;" href="http://github.com/econchick" title="GitHub"></a></li>
                    <li><a class="icon rss" data-icon="&#59194;" href="http://www.roguelynn.com/feed.xml" title="RSS"></a></li>
                    <li>© 2007–2013 Lynn Root. All Rights Reserved.</li>
                </ul>
            </footer>
        </div>
        <!--Javascript-->
        <script src="/assets/js/jquery-1.7.2.min.js" type="text/javascript" charset="utf-8"></script>
        <!-- Start of StatCounter Code for Default Guide -->
        <script type="text/javascript">
        var sc_project=4334716; 
        var sc_invisible=1; 
        var sc_security="d7034a4d"; 
        </script>
        <script type="text/javascript"
        src="http://www.statcounter.com/counter/counter.js"></script>
        <noscript><div class="statcounter"><a title="web stats"
        href="http://statcounter.com/free-web-stats/"
        target="_blank"><img class="statcounter"
        src="http://c.statcounter.com/4334716/0/d7034a4d/1/"
        alt="web stats"></a></div></noscript>
        <!-- End of StatCounter Code for Default Guide -->
        <script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-6966504-1']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();

        </script>
    </body>
</html>