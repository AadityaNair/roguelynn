<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">

        <title>How to spy with Python: so easy, the NSA can do it — Lynn Root</title>
        <meta name="description" content="Homepage and blog of Lynn Root. Python Engineer, PyLadiesSF Founder, Socializer in San Francisco." />
        <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/ico" />
        <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="http://www.roguelynn.com/feed.xml" />


        <!--Stylesheets-->
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Droid+Serif' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/assets/css/lightbox.css" media="screen" title="screen">
        <link rel="stylesheet" href="/assets/css/pygments3.css" media="screen" title="screen">
        <link rel="stylesheet" href="/assets/css/bootstrap.css" media="screen" title="screen">
        <link rel="stylesheet" href="/assets/css/bootstrap-responsive.css" media="screen" title="screen">
        <link rel="stylesheet" href="/assets/css/screen2.css" media="screen" title="screen">

        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        
    </head>
    <body>
    <div class="container">
      <div class="row">
        <div class="span2">
          <div class="avatar-section">
            <a id="avatar" href="/"></a>
            <ul>
              <li><a href="/">Home</a></li>
              <li><a href="/about">About</a></li>
              <li><a href="/words">Words</a></li>
              <li><a href="/talks">Talks</a></li>
              <li><a href="/pyladies">PyLadies</a></li>
            </ul>
          </div>
        </div>
        <div class="span9">
            

<article class='ten columns offset-by-four' id="article-content">
  <header class="ten columns" id="article-header">
    <h1>How to spy with Python: so easy, the NSA can do it</h1>
  </header>

  <div class='ten columns gray' id="date-header">
    <p>
      November 23rd, 2013
  
    </p>

  </div>

  <div class="ten columns" id="article-content">
    <p>I’ve previously spoken about <a href="http://www.roguelynn.com/prism">PRISM</a> at both <a href="http://pycon.ca">PyCon Canada</a> and <a href="http://python.ie/pycon/2013/">PyCon Ireland</a>.  For <a href="http://blah">PyConES</a> in Madrid this year, I decided to combine the PRISM talk with a bit of Python.  Because, why not?  Slides from PyConES can be found <a href="http://blah">here</a>.</p>
<h4 id="disclaimer">Disclaimer</h4>
<p>I am not a lawyer, nor have I studied law in anyway.  I’m a typical American with the <a href="http://www.archives.gov/exhibits/charters/constitution.html">US Constitution</a> and the <a href="http://www.archives.gov/exhibits/charters/bill_of_rights_transcript.html">Bill of Rights</a> engrained in my soul.</p>

<p>Nor have I had any experience in three-letter-government-agencies-that-are-out-to-get-you, or currently work/have worked for a company involved in PRISM (or at least not that I’m aware of).</p>

<p>This post has no special insight nor conspiracy theories, just painting a story from publicly available research.</p>
<h4 id="overview-amp-context">Overview &amp; Context</h4>
<p>To read more about what PRISM and XKeyScore is, I detail the history and context in my <a href="http://www.roguelynn.com/prism">previous post</a>.</p>
<h2 id="how-to-spy-with-python">How to Spy with Python</h2>
<p>Below are a few proof of concepts that take the published spy queries on the NSA’s XKeyScore slides.  These are meant to be simplistic and not scalable.</p>
<h3 id="tools-used">Tools used</h3>
<ul>
<li><a href="http://blah">Scapy</a></li>
<li><a href="http://blah">pygeoip</a></li>
<li><a href="http://blah">geojson</a></li>
<li><a href="http://blah">python-nmap</a></li>
</ul>
<h3 id="quick-how-to-with-scapy">Quick How-to with Scapy</h3>
<p>First off, what makes me cringe, per Scapy’s <a href="http://blah">documentation</a>:</p>

<pre class="ipynb">
>>> from scapy.all import *
</pre>

<p>or from the terminal:</p>

<pre class="ipynb">
$ sudo scapy
</pre>

<p>To sniff the wireless, Scapy has a sniff function.  Here, tell Scapy to sniff on my wifi card, <code>en0</code>, which can be found via <code>ifconfig</code> functionality in your terminal.  If you don’t specify an interface, it will default to all listed when you type <code>conf</code> in the terminal.</p>

<p>I’m filtering by TCP traffic and listing on port 80 only.  As well, I’m limited the sniff packets to only 10.  If you do not limit the number of packets collected, then it will continue until you interrupt the process.</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">sniff</span><span class="p">(</span><span class="n">iface</span><span class="o">=</span><span class="s">&quot;en0&quot;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s">&quot;tcp and port 80&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="o">&lt;</span><span class="n">Sniffed</span><span class="p">:</span> <span class="n">TCP</span><span class="p">:</span><span class="mi">10</span> <span class="n">UDP</span><span class="p">:</span><span class="mi">0</span> <span class="n">ICMP</span><span class="p">:</span><span class="mi">0</span> <span class="n">Other</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>To see all the packets, <code>a.res</code> returns a list with a barf of information, snipped below:</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">res</span>

<span class="p">[</span><span class="o">&lt;</span><span class="n">Ether</span>  <span class="n">dst</span><span class="o">=</span><span class="mo">00</span><span class="p">:</span><span class="mi">1</span><span class="n">d</span><span class="p">:</span><span class="mi">70</span><span class="p">:</span><span class="n">df</span><span class="p">:</span><span class="mi">2</span><span class="n">d</span><span class="p">:</span><span class="mi">11</span> <span class="n">src</span><span class="o">=</span><span class="mi">14</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="n">e1</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">9</span><span class="n">b</span> <span class="nb">type</span><span class="o">=</span><span class="mh">0x800</span> <span class="o">|&lt;</span><span class="n">IP</span>  <span class="n">version</span><span class="o">=</span><span class="il">4L</span> <span class="n">ihl</span><span class="o">=</span><span class="il">5L</span> <span class="n">tos</span><span class="o">=</span><span class="mh">0x0</span> <span class="nb">len</span><span class="o">=</span><span class="mi">64</span> <span class="nb">id</span><span class="o">=</span><span class="mi">650</span> <span class="n">flags</span><span class="o">=</span><span class="n">DF</span> <span class="n">frag</span><span class="o">=</span><span class="il">0L</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">proto</span><span class="o">=</span><span class="n">tcp</span> <span class="n">chksum</span><span class="o">=</span><span class="mh">0x9f88</span> <span class="n">src</span><span class="o">=</span><span class="mf">10.25</span><span class="o">.</span><span class="mf">3.61</span> <span class="n">dst</span><span class="o">=</span><span class="mf">184.73</span><span class="o">.</span><span class="mf">211.6</span> <span class="n">options</span><span class="o">=</span><span class="p">[]</span> <span class="o">|&lt;</span><span class="n">TCP</span>  <span class="n">sport</span><span class="o">=</span><span class="mi">53491</span> <span class="n">dport</span><span class="o">=</span><span class="n">http</span> <span class="n">seq</span><span class="o">=</span><span class="mi">3474155615</span> <span class="n">ack</span><span class="o">=</span><span class="mi">0</span> <span class="n">dataofs</span><span class="o">=</span><span class="il">11L</span> <span class="n">reserved</span><span class="o">=</span><span class="il">0L</span> <span class="n">flags</span><span class="o">=</span><span class="n">S</span> <span class="n">window</span><span class="o">=</span><span class="mi">65535</span> <span class="n">chksum</span><span class="o">=</span><span class="mh">0xecd6</span> <span class="n">urgptr</span><span class="o">=</span><span class="mi">0</span> <span class="n">options</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;MSS&#39;</span><span class="p">,</span> <span class="mi">1460</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;WScale&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1224433615</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="s">&#39;SAckOK&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;EOL&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span> <span class="o">|&gt;&gt;&gt;</span><span class="p">,</span>
<span class="c"># &lt;--snip--&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>Looking at the first packet:</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># first packet</span>
<span class="o">&lt;</span><span class="n">Ether</span>  <span class="n">dst</span><span class="o">=</span><span class="mo">00</span><span class="p">:</span><span class="mi">1</span><span class="n">d</span><span class="p">:</span><span class="mi">70</span><span class="p">:</span><span class="n">df</span><span class="p">:</span><span class="mi">2</span><span class="n">d</span><span class="p">:</span><span class="mi">11</span> <span class="n">src</span><span class="o">=</span><span class="mi">14</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="n">e1</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">9</span><span class="n">b</span> <span class="nb">type</span><span class="o">=</span><span class="mh">0x800</span> <span class="o">|&lt;</span><span class="n">IP</span>  <span class="n">version</span><span class="o">=</span><span class="il">4L</span> <span class="n">ihl</span><span class="o">=</span><span class="il">5L</span> <span class="n">tos</span><span class="o">=</span><span class="mh">0x0</span> <span class="nb">len</span><span class="o">=</span><span class="mi">64</span> <span class="nb">id</span><span class="o">=</span><span class="mi">650</span> <span class="n">flags</span><span class="o">=</span><span class="n">DF</span> <span class="n">frag</span><span class="o">=</span><span class="il">0L</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">proto</span><span class="o">=</span><span class="n">tcp</span> <span class="n">chksum</span><span class="o">=</span><span class="mh">0x9f88</span> <span class="n">src</span><span class="o">=</span><span class="mf">10.25</span><span class="o">.</span><span class="mf">3.61</span> <span class="n">dst</span><span class="o">=</span><span class="mf">184.73</span><span class="o">.</span><span class="mf">211.6</span> <span class="n">options</span><span class="o">=</span><span class="p">[]</span> <span class="o">|&lt;</span><span class="n">TCP</span>  <span class="n">sport</span><span class="o">=</span><span class="mi">53491</span> <span class="n">dport</span><span class="o">=</span><span class="n">http</span> <span class="n">seq</span><span class="o">=</span><span class="mi">3474155615</span> <span class="n">ack</span><span class="o">=</span><span class="mi">0</span> <span class="n">dataofs</span><span class="o">=</span><span class="il">11L</span> <span class="n">reserved</span><span class="o">=</span><span class="il">0L</span> <span class="n">flags</span><span class="o">=</span><span class="n">S</span> <span class="n">window</span><span class="o">=</span><span class="mi">65535</span> <span class="n">chksum</span><span class="o">=</span><span class="mh">0xecd6</span> <span class="n">urgptr</span><span class="o">=</span><span class="mi">0</span> <span class="n">options</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;MSS&#39;</span><span class="p">,</span> <span class="mi">1460</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;WScale&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1224433615</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="s">&#39;SAckOK&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;EOL&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span> <span class="o">|&gt;&gt;&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>And with Scapy’s “pretty printing” function, <code>show</code>:</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c">###[ Ethernet ]###</span>
    <span class="n">dst</span>       <span class="o">=</span> <span class="mo">00</span><span class="p">:</span><span class="mi">1</span><span class="n">d</span><span class="p">:</span><span class="mi">70</span><span class="p">:</span><span class="n">df</span><span class="p">:</span><span class="mi">2</span><span class="n">d</span><span class="p">:</span><span class="mi">11</span>
    <span class="n">src</span>       <span class="o">=</span> <span class="mi">14</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="n">e1</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">9</span><span class="n">b</span>
    <span class="nb">type</span>      <span class="o">=</span> <span class="mh">0x800</span>
  <span class="c">###[ IP ]###</span>
       <span class="n">version</span>   <span class="o">=</span> <span class="il">4L</span>
       <span class="n">ihl</span>       <span class="o">=</span> <span class="il">5L</span>
       <span class="n">tos</span>       <span class="o">=</span> <span class="mh">0x0</span>
       <span class="nb">len</span>       <span class="o">=</span> <span class="mi">64</span>
       <span class="nb">id</span>        <span class="o">=</span> <span class="mi">650</span>
       <span class="n">flags</span>     <span class="o">=</span> <span class="n">DF</span>
       <span class="n">frag</span>      <span class="o">=</span> <span class="il">0L</span>
       <span class="n">ttl</span>       <span class="o">=</span> <span class="mi">64</span>
       <span class="n">proto</span>     <span class="o">=</span> <span class="n">tcp</span>
       <span class="n">chksum</span>    <span class="o">=</span> <span class="mh">0x9f88</span>
       <span class="n">src</span>       <span class="o">=</span> <span class="mf">10.25</span><span class="o">.</span><span class="mf">3.61</span>
       <span class="n">dst</span>       <span class="o">=</span> <span class="mf">184.73</span><span class="o">.</span><span class="mf">211.6</span>
       \<span class="n">options</span>   \
   <span class="c">###[ TCP ]###</span>
          <span class="n">sport</span>     <span class="o">=</span> <span class="mi">53491</span>
          <span class="n">dport</span>     <span class="o">=</span> <span class="n">http</span>
          <span class="n">seq</span>       <span class="o">=</span> <span class="mi">3474155615</span>
          <span class="n">ack</span>       <span class="o">=</span> <span class="mi">0</span>
          <span class="n">dataofs</span>   <span class="o">=</span> <span class="il">11L</span>
          <span class="n">reserved</span>  <span class="o">=</span> <span class="il">0L</span>
          <span class="n">flags</span>     <span class="o">=</span> <span class="n">S</span>
          <span class="n">window</span>    <span class="o">=</span> <span class="mi">65535</span>
          <span class="n">chksum</span>    <span class="o">=</span> <span class="mh">0xecd6</span>
          <span class="n">urgptr</span>    <span class="o">=</span> <span class="mi">0</span>
          <span class="n">options</span>   <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;MSS&#39;</span><span class="p">,</span> <span class="mi">1460</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;WScale&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1224433615</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="s">&#39;SAckOK&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;EOL&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span>
</pre></div>
</td></tr></table></div></div><h4 id="query-1-show-me-everyone-that-has-searched-for-y-term">Query 1: Show me everyone that has searched for $Y term</h4>
<p><strong>Approach:</strong></p>

<ul>
<li>Filter for tcp &amp; host = google.com</li>
<li>Parse packets for &quot;q=&quot; plus the search term, eg &quot;q=ice+cream&quot; (note: URL encoding!)</li>
</ul>

<p>Again, the ugly import:<br>
<code>python<br>
from scapy.all import *<br>
</code></p>

<p>We filter for TCP traffic and for host <code>search.yahoo.com</code>.  I chose Yahoo because they do not send search queries over HTTPS, which Google now does (at least in the US).</p>

<p>You can either sniff online:</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">pkts</span> <span class="o">=</span> <span class="n">sniff</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="s">&quot;tcp and host search.yahoo.com&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># saving for later</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wrpcap</span><span class="p">(</span><span class="s">&quot;data/yahoo_search.cap&quot;</span><span class="p">,</span> <span class="n">pkts</span><span class="p">)</span>
</pre></div>
</td></tr></table></div></div>
<p>Or use a previously saved pcap file (from Scapy’s <code>wrpcap</code> function or from wireshark/tshark/tcpdump/etc.):</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># importing pcap file</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sample_http</span> <span class="o">=</span> <span class="s">&#39;data/yahoo_search.cap&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pkts</span> <span class="o">=</span> <span class="n">sniff</span><span class="p">(</span><span class="n">offline</span><span class="o">=</span><span class="n">sample_http</span><span class="p">)</span>
</pre></div>
</td></tr></table></div></div>
<p>I see that I’ve collected 300 TCP packets:</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">pkts</span>
<span class="o">&lt;</span><span class="n">Sniffed</span><span class="p">:</span> <span class="n">TCP</span><span class="p">:</span><span class="mi">300</span> <span class="n">UDP</span><span class="p">:</span><span class="mi">0</span> <span class="n">ICMP</span><span class="p">:</span><span class="mi">0</span> <span class="n">Other</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>Using Scapy’s <code>nsummary</code> function (output snipped a bit):</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">pkts</span><span class="o">.</span><span class="n">nsummary</span><span class="p">()</span>
<span class="mo">0000</span> <span class="n">Ether</span> <span class="o">/</span> <span class="n">IP</span> <span class="o">/</span> <span class="n">TCP</span> <span class="mf">10.25</span><span class="o">.</span><span class="mf">3.61</span><span class="p">:</span><span class="mi">53261</span> <span class="o">&gt;</span> <span class="mf">74.6</span><span class="o">.</span><span class="mf">239.58</span><span class="p">:</span><span class="n">http</span> <span class="n">S</span>
<span class="mo">0001</span> <span class="n">Ether</span> <span class="o">/</span> <span class="n">IP</span> <span class="o">/</span> <span class="n">TCP</span> <span class="mf">10.25</span><span class="o">.</span><span class="mf">3.61</span><span class="p">:</span><span class="mi">53262</span> <span class="o">&gt;</span> <span class="mf">74.6</span><span class="o">.</span><span class="mf">239.58</span><span class="p">:</span><span class="n">http</span> <span class="n">S</span>
<span class="mo">0002</span> <span class="n">Ether</span> <span class="o">/</span> <span class="n">IP</span> <span class="o">/</span> <span class="n">TCP</span> <span class="mf">10.25</span><span class="o">.</span><span class="mf">3.61</span><span class="p">:</span><span class="mi">53263</span> <span class="o">&gt;</span> <span class="mf">74.6</span><span class="o">.</span><span class="mf">239.58</span><span class="p">:</span><span class="n">http</span> <span class="n">S</span>
<span class="mo">0003</span> <span class="n">Ether</span> <span class="o">/</span> <span class="n">IP</span> <span class="o">/</span> <span class="n">TCP</span> <span class="mf">74.6</span><span class="o">.</span><span class="mf">239.58</span><span class="p">:</span><span class="n">http</span> <span class="o">&gt;</span> <span class="mf">10.25</span><span class="o">.</span><span class="mf">3.61</span><span class="p">:</span><span class="mi">53261</span> <span class="n">SA</span>
<span class="mo">0004</span> <span class="n">Ether</span> <span class="o">/</span> <span class="n">IP</span> <span class="o">/</span> <span class="n">TCP</span> <span class="mf">10.25</span><span class="o">.</span><span class="mf">3.61</span><span class="p">:</span><span class="mi">53261</span> <span class="o">&gt;</span> <span class="mf">74.6</span><span class="o">.</span><span class="mf">239.58</span><span class="p">:</span><span class="n">http</span> <span class="n">A</span>
<span class="c"># &lt;--snip--&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>I saw that packet 79 had A / Raw (as opposed to A / Raw / Padding or something else) from the <code>pkts.nsummary()</code> command.  Taking a look at that packet in particular:</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">pkts</span><span class="p">[</span><span class="mi">79</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

     <span class="c">###[ Ethernet ]###</span>
       <span class="n">dst</span>       <span class="o">=</span> <span class="mo">00</span><span class="p">:</span><span class="mi">1</span><span class="n">d</span><span class="p">:</span><span class="mi">70</span><span class="p">:</span><span class="n">df</span><span class="p">:</span><span class="mi">2</span><span class="n">d</span><span class="p">:</span><span class="mi">11</span>
       <span class="n">src</span>       <span class="o">=</span> <span class="mi">14</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="n">e1</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">9</span><span class="n">b</span>
       <span class="nb">type</span>      <span class="o">=</span> <span class="mh">0x800</span>
     <span class="c">###[ IP ]###</span>
          <span class="n">version</span>   <span class="o">=</span> <span class="il">4L</span>
          <span class="n">ihl</span>       <span class="o">=</span> <span class="il">5L</span>
          <span class="n">tos</span>       <span class="o">=</span> <span class="mh">0x0</span>
          <span class="nb">len</span>       <span class="o">=</span> <span class="mi">1420</span>
          <span class="nb">id</span>        <span class="o">=</span> <span class="mi">51853</span>
          <span class="n">flags</span>     <span class="o">=</span> <span class="n">DF</span>
          <span class="n">frag</span>      <span class="o">=</span> <span class="il">0L</span>
          <span class="n">ttl</span>       <span class="o">=</span> <span class="mi">64</span>
          <span class="n">proto</span>     <span class="o">=</span> <span class="n">tcp</span>
          <span class="n">chksum</span>    <span class="o">=</span> <span class="mh">0x2448</span>
          <span class="n">src</span>       <span class="o">=</span> <span class="mf">10.25</span><span class="o">.</span><span class="mf">3.61</span>
          <span class="n">dst</span>       <span class="o">=</span> <span class="mf">74.6</span><span class="o">.</span><span class="mf">239.58</span>
          \<span class="n">options</span>   \
     <span class="c">###[ TCP ]###</span>
             <span class="n">sport</span>     <span class="o">=</span> <span class="mi">53261</span>
             <span class="n">dport</span>     <span class="o">=</span> <span class="n">http</span>
             <span class="n">seq</span>       <span class="o">=</span> <span class="mi">3423577226</span>
             <span class="n">ack</span>       <span class="o">=</span> <span class="mi">4075984347</span>
             <span class="n">dataofs</span>   <span class="o">=</span> <span class="il">8L</span>
             <span class="n">reserved</span>  <span class="o">=</span> <span class="il">0L</span>
             <span class="n">flags</span>     <span class="o">=</span> <span class="n">A</span>
             <span class="n">window</span>    <span class="o">=</span> <span class="mi">8192</span>
             <span class="n">chksum</span>    <span class="o">=</span> <span class="mh">0xe4ca</span>
             <span class="n">urgptr</span>    <span class="o">=</span> <span class="mi">0</span>
             <span class="n">options</span>   <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;NOP&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1222799014</span><span class="p">,</span> <span class="mi">196990643</span><span class="p">))]</span>
     <span class="c">###[ Raw ]###</span>
                <span class="n">load</span>      <span class="o">=</span> <span class="s">&#39;GET /search;_ylt=A0oG7mGUD49SBxcA3WpXNyoA;_ylc=X1MDMjc2NjY3OQRfcgMyBGJjawNmbWVsb2s1OTRqZ3UyJTI2YiUzRDQlMjZkJTNEOU15M2RnMXBZRUtpdVJyeG9BWlNlRGxLcjJFLSUyNnMlM0Q4ciUyNmklM0RTSjdlY2Y4ZURZakZnbS5DRWRucgRjc3JjcHZpZANHcC5VRjBnZXVyRDdPcmloVWtuRHdnWUFYWjUwR1ZLUEQ1UUFCc3hpBGZyA3lmcC10LTE0MARmcjIDc2ItdG9wBGdwcmlkA2NlVHN4WXhzUWIuOW51aGNlWG9TTUEEbXRlc3RpZANBRDAxJTNEU01FMzQxJTI2QURTUlAlM0RBRFNSUEMxJTI2QVNTVCUzRFZJUDI4OSUyNk1TRlQlM0RNU1kwMTAlMjZVSTAxJTNEVUlDMSUyNlVOSSUzRFJDRjA0NARuX3JzbHQDMTAEbl9zdWdnAzgEb3JpZ2luA3NlYXJjaC55YWhvby5jb20EcG9zAzAEcHFzdHIDBHBxc3RybAMEcXN0cmwDNgRxdWVyeQNNYWRyaWQEdF9zdG1wAzEzODUxMDczNTU4MzEEdnRlc3RpZANVSUMx?p=Madrid&amp;fr2=sb-top&amp;fr=yfp-t-140 HTTP/1.1</span><span class="se">\r\n</span><span class="s">Host: search.yahoo.com</span><span class="se">\r\n</span><span class="s">Connection: keep-alive</span><span class="se">\r\n</span><span class="s">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><span class="se">\r\n</span><span class="s">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.57 Safari/537.36</span><span class="se">\r\n</span><span class="s">Referer: http://search.yahoo.com/search;_ylt=ApD.LW7jivmrlmZzNKxChqqbvZx4?p=Python&amp;toggle=1&amp;cop=mss&amp;ei=UTF-8&amp;fr=yfp-t-140</span><span class="se">\r\n</span><span class="s">Accept-Encoding: gzip,deflate,sdch</span><span class="se">\r\n</span><span class="s">Accept-Language: en-US,en;q=0.8</span><span class="se">\r\n</span><span class="s">Cookie: B=fmelok594jgu2&amp;b=4&amp;d=9My3dg1pYEKiuRrxoAZSeDlKr2E-&amp;s=8r&amp;i=SJ7ecf8eDYjFgm.CEdnr; AO=o=0; YLS=v=1&amp;p=1&amp;n=1; F=a=I.qqZFgMvSp1SMQ7oNaJGIBu5DAJGO25SeRxXSKxg6_KZLWHQMHEkeFQrEOxAH9BOvMhwKs-&amp;b=.hBp; Y=v=1&amp;n=fr6nunkr11qks&amp;l=he6k4bodd/o&amp;p=f2m0&#39;</span>
</pre></div>
</td></tr></table></div></div>
<p>Let’s just grab the “Raw” layer specifically:</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">pkts</span><span class="p">[</span><span class="mi">79</span><span class="p">]</span><span class="o">.</span><span class="n">getlayer</span><span class="p">(</span><span class="n">Raw</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Raw</span>  <span class="n">load</span><span class="o">=</span><span class="s">&#39;GET /search;_ylt=A0oG7mGUD49SBxcA3WpXNyoA;_ylc=X1MDMjc2NjY3OQRfcgMyBGJjawNmbWVsb2s1OTRqZ3UyJTI2YiUzRDQlMjZkJTNEOU15M2RnMXBZRUtpdVJyeG9BWlNlRGxLcjJFLSUyNnMlM0Q4ciUyNmklM0RTSjdlY2Y4ZURZakZnbS5DRWRucgRjc3JjcHZpZANHcC5VRjBnZXVyRDdPcmloVWtuRHdnWUFYWjUwR1ZLUEQ1UUFCc3hpBGZyA3lmcC10LTE0MARmcjIDc2ItdG9wBGdwcmlkA2NlVHN4WXhzUWIuOW51aGNlWG9TTUEEbXRlc3RpZANBRDAxJTNEU01FMzQxJTI2QURTUlAlM0RBRFNSUEMxJTI2QVNTVCUzRFZJUDI4OSUyNk1TRlQlM0RNU1kwMTAlMjZVSTAxJTNEVUlDMSUyNlVOSSUzRFJDRjA0NARuX3JzbHQDMTAEbl9zdWdnAzgEb3JpZ2luA3NlYXJjaC55YWhvby5jb20EcG9zAzAEcHFzdHIDBHBxc3RybAMEcXN0cmwDNgRxdWVyeQNNYWRyaWQEdF9zdG1wAzEzODUxMDczNTU4MzEEdnRlc3RpZANVSUMx?p=Madrid&amp;fr2=sb-top&amp;fr=yfp-t-140 HTTP/1.1</span><span class="se">\r\n</span><span class="s">Host: search.yahoo.com</span><span class="se">\r\n</span><span class="s">Connection: keep-alive</span><span class="se">\r\n</span><span class="s">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><span class="se">\r\n</span><span class="s">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.57 Safari/537.36</span><span class="se">\r\n</span><span class="s">Referer: http://search.yahoo.com/search;_ylt=ApD.LW7jivmrlmZzNKxChqqbvZx4?p=Python&amp;toggle=1&amp;cop=mss&amp;ei=UTF-8&amp;fr=yfp-t-140</span><span class="se">\r\n</span><span class="s">Accept-Encoding: gzip,deflate,sdch</span><span class="se">\r\n</span><span class="s">Accept-Language: en-US,en;q=0.8</span><span class="se">\r\n</span><span class="s">Cookie: B=fmelok594jgu2&amp;b=4&amp;d=9My3dg1pYEKiuRrxoAZSeDlKr2E-&amp;s=8r&amp;i=SJ7ecf8eDYjFgm.CEdnr; AO=o=0; YLS=v=1&amp;p=1&amp;n=1; F=a=I.qqZFgMvSp1SMQ7oNaJGIBu5DAJGO25SeRxXSKxg6_KZLWHQMHEkeFQrEOxAH9BOvMhwKs-&amp;b=.hBp; Y=v=1&amp;n=fr6nunkr11qks&amp;l=he6k4bodd/o&amp;p=f2m0&#39;</span> <span class="o">|&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>We start to see something a little bit more interesting.  I’m going to parse this a little bit.  When physically searching via Yahoo, I noticed that the search term comes after <code>?p=</code> and before <code>&amp;</code> in my browser, so I’ll do some splitting:</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">first_query</span> <span class="o">=</span> <span class="n">pkts</span><span class="p">[</span><span class="mi">79</span><span class="p">]</span><span class="o">.</span><span class="n">getlayer</span><span class="p">(</span><span class="n">Raw</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">first_query</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;load&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;?p=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;&amp;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Madrid</span>
</pre></div>
</td></tr></table></div></div>
<p>Ha! I searched for Madrid!  Let’s check some other queries out: </p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">second_query</span> <span class="o">=</span> <span class="n">pkts</span><span class="p">[</span><span class="mi">148</span><span class="p">]</span><span class="o">.</span><span class="n">getlayer</span><span class="p">(</span><span class="n">Raw</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">second_query</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;load&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;?p=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;&amp;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">I</span><span class="o">+</span><span class="n">love</span><span class="o">+</span><span class="n">chocolate</span>
</pre></div>
</td></tr></table></div></div>
<p>I misspelled my favorite coffee place when searching:</p>
<div class="code"><div><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">third_query</span> <span class="o">=</span> <span class="n">pkts</span><span class="p">[</span><span class="mi">227</span><span class="p">]</span><span class="o">.</span><span class="n">getlayer</span><span class="p">(</span><span class="n">Raw</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">third_query</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;load&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;?p=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;&amp;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Blue</span><span class="o">+</span><span class="n">Bottle</span><span class="o">+</span><span class="n">Coffe</span>
</pre></div>
</td></tr></table></div></div><h4 id="query-2-how-me-everyone-from-x-country-that-has-visited-y-extremist-forum">Query 2: How me everyone from $X country that has visited $Y extremist forum</h4>
<p><strong>Approach:</strong></p>

<ul>
<li>Filter for source IP &amp; destination IP, and traceroute those IPs:</li>
</ul>

<iframe src="http://nbviewer.ipython.org/7588949" width="900" height="500"></iframe>

<ul>
<li>Filter for GET term like above:</li>
</ul>

<iframe src="http://nbviewer.ipython.org/7589025" width="900" height="500"></iframe>
<h4 id="query-3-give-me-all-emails-with-x-in-the-body-of-the-email">Query 3: Give me all emails with $X in the body of the email</h4>
<p><strong>Approach:</strong></p>

<ul>
<li>Filter for HTTP traffic and &quot;POST&quot; for sent - if sent via web interface then will probably be over HTTPS (save packet for decryption later!)</li>
<li>OR Filter for port 25</li>
<li><p>Once packets are collected, parse packets</p></li>
<li><p>Download and save this <a href="http://wiki.wireshark.org/SampleCaptures?action=AttachFile&amp;do=get&amp;target=smtp.pcap">sample pcap file</a> from Wireskark’s <a href="http://wiki.wireshark.org/SampleCaptures">Sample Captures</a> for an example of smtp traffic.</p></li>
<li><p>Now parsing and putting together the raw data (decoded base64 if needed), you can do a simple search for key terms.</p></li>
</ul>

<iframe src="http://nbviewer.ipython.org/7589033" width="900" height="500"></iframe>
<h4 id="query-4-give-me-pgp-usage-from-z-country">Query 4: Give me PGP usage from $Z country</h4>
<p><strong>Approach:</strong><br>
Very similar to above, sniff for SMTP traffic.  Then just parse/search for &#39;multipart/encrypted&#39; and/or &#39;protocol=&quot;application/pgp-encrypted&quot;&#39; within &quot;Content-Type&quot; header of the email.  This just tells you that the email has been encrypted with PGP.  Now, we already have a database collections/hosts of PGP/GPG keys, so I&#39;m sure the NSA is getting their cryptographers on it!</p>

<iframe src="http://nbviewer.ipython.org/7589056" width="900" height="500"></iframe>
<h4 id="query-5-show-me-chats-for-x-user-during-y-timeframe">Query 5: Show me chats for $X user during $Y timeframe</h4>
<p><strong>Approach:</strong><br>
You will need to disable your SSL connection to the chat server.  Then just sniff for XMPP traffic (Jabber, Facebook, gchat) or IRC traffic (TCP + port 6667 (typically)).</p>

<iframe src="http://nbtest.herokuapp.com/gist/econchick/7589075" width="900" height="500"></iframe>
<h4 id="query-6-find-all-exploitable-machines-in-z-country">Query 6: Find all exploitable machines in $Z Country</h4>
<p><strong>Approach:</strong></p>

<ul>
<li>Create a port sniffer - responses return OS</li>
<li>Geolocate machines with the resolved IP addresses</li>
<li>Either search for a specific machine, or combile and/or query a database needed of known exploitable machines (e.g. <a href="http://www.shodanhq.com/">shodan</a>)</li>
</ul>

<iframe src="http://nbviewer.ipython.org/7589366" width="900" height="500"></iframe>
<h4 id="other-easy-tricks">Other easy tricks</h4>
<ul>
<li>VoIP calls: protocol filter = SIP</li>
<li>Can easily read Chrome/Firefox/Skype sqlite databases once inside someone&#39;s machine</li>
<li>Physical location of where you&#39;ve connected to - can get the SSID via wireshark/scapy, and use wigle.net to search by SSID</li>
</ul>

    <p id="footer">&#8756;</p>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'roguelynn'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
  </div>
</article>

        </div>
      </div>
    </div>
    <div class="footer-wrapper">
        <footer id="bottom">
            <ul class="social">
                <li><a class="icon twitter" data-icon="&#62217;" href="http://twitter.com/roguelynn" title="Twitter"></a></li>
                <li><a class="icon github" data-icon="&#62208;" href="http://github.com/econchick" title="GitHub"></a></li>
                <li><a class="icon photos" data-icon="&#128247;" href="http://500px.com/roguelynn" title="500px"></a><li>
                <li><a class="icon spotify" data-icon="&#62247;" href="http://open.spotify.com/user/econchick" title="Spotify"></a></li>
                <li><a class="icon flattr" data-icon="&#62262;" href="https://flattr.com/profile/roguelynn" title="Flattr"></a></li>
                <li><a class="icon email" data-icon="&#10002;" href="mailto:lynn+roguelynn@lynnroot.com?subject:Hello!" title="Email"></a></li>
                <li><a class="icon airplane" data-icon="&#9992;" href="https://www.tripit.com/people/lynn.root" title="Tripit"></a></li>
                <li><a class="icon rss" data-icon="&#59194;" href="http://www.roguelynn.com/feed.xml" title="RSS"></a></li>
                <li><a class="icon ohours" data-icon="&#59168;" href="http://ohours.org/roguelynn"></a></li>
                <li>© 2007–2013 Lynn Root. All Rights Reserved.</li>
            </ul>
        </footer>
    </div>
        
        <!--Javascript-->
        <script src="/assets/js/jquery-1.7.2.min.js" type="text/javascript" charset="utf-8"></script>
        <!-- Start of StatCounter Code for Default Guide -->
        <script type="text/javascript">
        var sc_project=4334716;
        var sc_invisible=1;
        var sc_security="d7034a4d";
        </script>
        <script type="text/javascript"
        src="http://www.statcounter.com/counter/counter.js"></script>
        <noscript><div class="statcounter"><a title="web stats"
        href="http://statcounter.com/free-web-stats/"
        target="_blank"><img class="statcounter"
        src="http://c.statcounter.com/4334716/0/d7034a4d/1/"
        alt="web stats"></a></div></noscript>
        <!-- End of StatCounter Code for Default Guide -->
        <script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-6966504-1']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();

        </script>
        <!-- Piwik -->
        <script type="text/javascript">
          var _paq = _paq || [];
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setCookieDomain", "*.roguelynn.com"]);
          _paq.push(["setDomains", ["*.roguelynn.com"]]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);

          (function() {
            var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.ox.cx/";
            _paq.push(["setTrackerUrl", u+"piwik.php"]);
            _paq.push(["setSiteId", "9"]);
            var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
            g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <noscript>
            <!-- Piwik Image Tracker -->
            <img src="http://stats.ox.cx/piwik.php?idsite=9&amp;rec=1&action_name=homepage" style="border:0" alt="" />
            <!-- End Piwik -->
        </noscript>
        <!-- End Piwik Code -->
    </body>
</html>